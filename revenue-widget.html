<!-- Revenue Widget - Add to dashboard.html -->
<div style="background: linear-gradient(135deg, #ff0080, #ff8c00); padding: 2rem; border-radius: 12px; margin: 1rem 0; color: white;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h3 style="margin: 0 0 0.5rem 0;">ðŸ’° Your Revenue</h3>
            <div style="font-size: 2.5rem; font-weight: bold;" id="dashboard-revenue">$0.00</div>
            <p style="margin: 0.5rem 0 0 0; opacity: 0.8; font-size: 0.9rem;">This month</p>
        </div>
        <div style="text-align: right;">
            <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem;">
                <span id="dashboard-customers">0</span> paying customers
            </div>
            <div style="font-size: 0.9rem; opacity: 0.8;">
                Avg: <span id="dashboard-avg">$0.00</span>/customer
            </div>
        </div>
    </div>
</div>

<script>
// Load and update revenue in real-time
async function loadDashboardRevenue() {
    if (!window.firebaseDb || !currentUser) return;
    
    try {
        const now = new Date();
        const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
        
        const snapshot = await window.firebaseDb
            .collection('transactions')
            .where('status', '==', 'completed')
            .where('timestamp', '>=', monthStart)
            .get();
        
        let totalRevenue = 0;
        let customerSet = new Set();
        
        snapshot.forEach(doc => {
            const data = doc.data();
            totalRevenue += (data.amount || 0);
            if (data.userEmail) customerSet.add(data.userEmail);
        });
        
        const customerCount = customerSet.size;
        const avgRevenue = customerCount > 0 ? totalRevenue / customerCount : 0;
        
        document.getElementById('dashboard-revenue').textContent = '$' + totalRevenue.toFixed(2);
        document.getElementById('dashboard-customers').textContent = customerCount;
        document.getElementById('dashboard-avg').textContent = '$' + avgRevenue.toFixed(2);
    } catch (error) {
        console.error('Error loading dashboard revenue:', error);
    }
}

// Setup real-time listener
if (window.firebaseDb) {
    window.firebaseDb.collection('transactions').onSnapshot(() => {
        loadDashboardRevenue();
    });
    
    // Initial load
    loadDashboardRevenue();
}
</script>
